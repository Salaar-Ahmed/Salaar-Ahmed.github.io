<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>for Sara · eternal Valentine</title>
  <style>
    /* ===== original galactic soul + new glowing, ribbon, flower ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --whisper: #F2EAF7;
      --wisteria: #C59DD9;
      --velvet: #7A3F91;
      --sacred: #2B0D3E;
      --transition-slow: 1.2s cubic-bezier(0.2, 0.9, 0.3, 1);
      --transition-ceremony: 0.9s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      --font-serif: 'Georgia', 'Times New Roman', serif;
      --font-sans: 'Avenir', 'Segoe UI', 'Roboto', system-ui, sans-serif;
      --glass-bg: rgba(242, 234, 247, 0.12);
      --glass-border: rgba(197, 157, 217, 0.25);
      --card-shadow: 0 30px 60px -20px rgba(43, 13, 62, 0.6), 0 0 0 1px rgba(197, 157, 217, 0.2) inset;
      --space-xs: 0.5rem;
      --space-sm: 0.8rem;
      --space-md: 1.2rem;
      --space-lg: 1.8rem;
      --space-xl: 2.2rem;
    }

    @media (prefers-reduced-motion: reduce) {
      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
    }

    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--sacred);
      font-family: var(--font-sans);
      color: var(--whisper);
      padding: var(--space-sm);
      margin: 0;
      position: relative;
      overflow-x: hidden;
    }

    /* galactic gradient (preserved) */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 40% 50%, var(--velvet) 0%, var(--sacred) 80%);
      filter: blur(8px);
      opacity: 0.9;
      z-index: -2;
      animation: galaxyBreath 12s infinite alternate ease-in-out;
    }

    @keyframes galaxyBreath {
      0% { transform: scale(1); opacity: 0.7; background: radial-gradient(circle at 30% 60%, #8a4ba0, #2B0D3E); }
      100% { transform: scale(1.08); opacity: 1; background: radial-gradient(circle at 60% 40%, #b47bc9, #351a47); }
    }

    body::after {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><filter id="noise"><feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="1" stitchTiles="stitch"/><feColorMatrix type="matrix" values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 0.05 0"/></filter><rect width="100" height="100" filter="url(%23noise)" opacity="0.12"/></svg>');
      opacity: 0.1;
      pointer-events: none;
      z-index: -1;
      mix-blend-mode: overlay;
    }

    .canvas {
      width: 100%;
      max-width: 420px;
      aspect-ratio: 9 / 16;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    /* ===== CARD with GLOW animation (infinite smooth) ===== */
    .card {
      width: 100%;
      height: 100%;
      background: var(--glass-bg);
      backdrop-filter: blur(24px) saturate(180%);
      -webkit-backdrop-filter: blur(24px) saturate(180%);
      border-radius: min(42px, 8vw) min(42px, 8vw) min(38px, 7vw) min(38px, 7vw);
      border: 1px solid var(--glass-border);
      box-shadow: var(--card-shadow);
      padding: clamp(1.2rem, 6vw, 2.2rem) clamp(1rem, 5vw, 1.8rem);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
      transition: box-shadow 0.3s, border-color 0.3s;
      /* glowing animation – slow pulse */
      animation: cardGlow 4s infinite alternate ease-in-out;
    }

    @keyframes cardGlow {
      0% { box-shadow: 0 30px 60px -20px rgba(43, 13, 62, 0.6), 0 0 0 1px rgba(197, 157, 217, 0.3) inset, 0 0 15px rgba(197, 157, 217, 0.2); }
      100% { box-shadow: 0 30px 70px -10px #b692cf, 0 0 0 2px rgba(230, 200, 255, 0.5) inset, 0 0 35px #c59dd9; }
    }

    .particle-field {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
    }

    .orb {
      position: absolute;
      border-radius: 50%;
      filter: blur(20px);
      opacity: 0.5;
      background: radial-gradient(circle at 30% 30%, var(--wisteria), rgba(197, 157, 217, 0.1));
      animation: floatOrb 16s infinite alternate ease-in-out;
    }

    @keyframes floatOrb {
      0% { transform: translate(0, 0) scale(1); }
      100% { transform: translate(6%, 8%) scale(1.2); }
    }

    .scene {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: opacity var(--transition-slow), transform var(--transition-slow);
      position: relative;
      z-index: 5;
    }

    .scene--hidden {
      opacity: 0;
      transform: scale(0.96);
      pointer-events: none;
      position: absolute;
    }

    .proposition {
      text-align: center;
      width: 100%;
    }

    .greeting {
      font-family: var(--font-serif);
      font-weight: 400;
      font-size: clamp(1rem, 5vw, 1.8rem);
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--wisteria);
      margin-bottom: var(--space-xs);
      opacity: 0.8;
      text-shadow: 0 0 12px rgba(197, 157, 217, 0.5);
    }

    .name {
      font-size: clamp(2rem, 10vw, 3.8rem);
      font-family: var(--font-serif);
      font-weight: 400;
      line-height: 1.1;
      color: var(--whisper);
      margin-bottom: var(--space-xs);
      text-shadow: 0 0 18px rgba(255, 240, 250, 0.6);
      letter-spacing: -0.01em;
    }

    .question {
      font-size: clamp(1rem, 4vw, 1.2rem);
      margin: var(--space-md) 0 var(--space-lg);
      font-style: italic;
      color: rgba(242, 234, 247, 0.9);
      border-top: 1px solid rgba(197, 157, 217, 0.3);
      border-bottom: 1px solid rgba(197, 157, 217, 0.3);
      padding: var(--space-sm) 0;
      max-width: min(280px, 80%);
      margin-left: auto;
      margin-right: auto;
      font-weight: 300;
      backdrop-filter: blur(4px);
    }

    .gestures {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      gap: clamp(1.5rem, 8vw, 2.5rem);
      margin-top: var(--space-sm);
      width: 100%;
      flex-wrap: wrap;
    }

    .gesture {
      border: none;
      background: transparent;
      font-family: var(--font-serif);
      font-size: clamp(1.8rem, 7vw, 2.2rem);
      font-weight: 300;
      padding: clamp(0.3rem, 2vw, 0.4rem) clamp(0.5rem, 3vw, 1rem);
      cursor: pointer;
      transition: all var(--transition-ceremony);
      position: relative;
      color: var(--whisper);
      text-shadow: 0 0 10px currentColor;
      letter-spacing: 0.2rem;
      line-height: 1;
      border-radius: 4px;
    }

    .gesture:focus-visible {
      outline: 3px solid var(--wisteria);
      outline-offset: 4px;
    }

    .gesture--yes {
      font-size: clamp(2.5rem, 9vw, 3.2rem);
      font-weight: 400;
      color: #fff;
      text-shadow: 0 0 24px var(--wisteria), 0 4px 12px rgba(122, 63, 145, 0.6);
    }

    .gesture--yes:hover,
    .gesture--yes:focus-visible {
      transform: scale(1.08);
      color: #ffffff;
      text-shadow: 0 0 32px #f2d3ff;
    }

    .gesture--no {
      font-size: clamp(1.6rem, 6vw, 2rem);
      color: rgba(242, 234, 247, 0.55);
      text-shadow: none;
      font-style: italic;
    }

    .gesture--no:hover,
    .gesture--no:focus-visible {
      color: var(--wisteria);
      text-shadow: 0 0 12px var(--velvet);
    }

    .micro-response {
      min-height: 70px;
      margin-top: var(--space-md);
      font-size: clamp(0.9rem, 3.5vw, 1.1rem);
      font-style: italic;
      color: var(--wisteria);
      opacity: 0;
      transition: opacity 0.9s ease, text-shadow 0.5s, transform 0.3s ease;
      text-align: center;
      padding: 0 var(--space-sm);
      letter-spacing: 0.03em;
      max-width: min(300px, 90%);
      transform: translateY(10px);
    }

    .micro-response--visible {
      opacity: 1;
      text-shadow: 0 0 16px #f0c4ff, 0 0 4px white;
      transform: translateY(0);
    }

    /* ===== SCENE 2 – LETTER with RIBBON FRAME & FLOATING FLOWER ===== */
    .letter {
      text-align: center;
      width: 100%;
      position: relative;
      z-index: 5;
    }

    /* flower behind table */
    .flower-bg {
      position: absolute;
      top: 45%;
      left: 50%;
      width: 220px;
      height: 220px;
      background: url('https://i.ibb.co/Ndjr77H4') no-repeat center/contain;
      opacity: 0.3;
      transform: translate(-50%, -50%);
      pointer-events: none;
      z-index: 1;
      animation: orbitFlower 16s infinite linear;
      filter: drop-shadow(0 0 8px #b692cf);
    }

    @keyframes orbitFlower {
      0% { transform: translate(-50%, -50%) rotate(0deg) scale(1); }
      25% { transform: translate(-45%, -55%) rotate(5deg) scale(1.02); }
      50% { transform: translate(-55%, -45%) rotate(0deg) scale(0.98); }
      75% { transform: translate(-48%, -52%) rotate(-5deg) scale(1.01); }
      100% { transform: translate(-50%, -50%) rotate(0deg) scale(1); }
    }

    /* ribbon frame – using pseudo element so it wraps edges elegantly */
    .ribbon-frame {
      position: relative;
      display: inline-block;
      width: 100%;
      z-index: 10;
    }
    .ribbon-frame::before {
      content: '';
      position: absolute;
      top: -12px;
      left: -12px;
      right: -12px;
      bottom: -12px;
      background: url('https://i.ibb.co/zVyrqQQ9') repeat 0 0 / 110px 110px;
      pointer-events: none;
      z-index: 12;
      opacity: 0.9;
      mix-blend-mode: overlay;
      image-rendering: crisp-edges;
      border-radius: min(50px, 8vw);
      transform: scale(1.02);
    }

    .letter-head {
      font-family: var(--font-serif);
      font-size: clamp(1.5rem, 6vw, 1.9rem);
      margin-bottom: 0.25rem;
      color: var(--whisper);
      text-shadow: 0 0 20px #b692cf;
      position: relative;
      z-index: 15;
    }

    .letter-sub {
      color: var(--wisteria);
      font-size: clamp(0.8rem, 3vw, 1rem);
      letter-spacing: 0.3rem;
      text-transform: uppercase;
      margin-bottom: clamp(1rem, 4vw, 2rem);
      position: relative;
      z-index: 15;
    }

    .letter-body {
      font-size: clamp(0.9rem, 3.5vw, 1.1rem);
      line-height: 1.8;
      color: rgba(255, 255, 255, 0.9);
      background: rgba(43, 13, 62, 0.3);
      backdrop-filter: blur(8px);
      padding: clamp(1rem, 4vw, 1.8rem) clamp(0.8rem, 3vw, 1.2rem);
      border-radius: min(40px, 6vw) min(20px, 4vw) min(40px, 6vw) min(20px, 4vw);
      border: 1px solid rgba(197, 157, 217, 0.3);
      margin: var(--space-sm) 0 var(--space-xs);
      font-weight: 300;
      box-shadow: 0 15px 35px -10px black;
      position: relative;
      z-index: 15;
    }

    .dua {
      font-family: var(--font-serif);
      font-size: clamp(1rem, 4vw, 1.2rem);
      font-style: italic;
      color: #e8d1ff;
      background: rgba(122, 63, 145, 0.2);
      border-radius: min(60px, 10vw);
      padding: clamp(0.6rem, 3vw, 0.8rem) clamp(1rem, 4vw, 1.5rem);
      margin-top: var(--space-xs);
      backdrop-filter: blur(4px);
      border: 1px dashed var(--wisteria);
      line-height: 1.5;
      position: relative;
      z-index: 15;
    }

    .shimmer-effect {
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none;
      background: radial-gradient(circle at var(--x, 50%) var(--y, 50%), rgba(255, 230, 240, 0.3) 0%, transparent 60%);
      opacity: 0;
      transition: opacity 0.6s;
      z-index: 10;
      border-radius: inherit;
    }

    .shimmer-effect.active {
      opacity: 1;
    }

    /* ===== SPOTIFY-STYLE AUDIO PLAYER ===== */
    .audio-player {
      position: absolute;
      bottom: clamp(10px, 4vh, 20px);
      left: clamp(10px, 4vw, 20px);
      z-index: 30;
      display: flex;
      align-items: center;
    }

    .audio-control {
      background: var(--glass-bg);
      backdrop-filter: blur(12px) saturate(180%);
      -webkit-backdrop-filter: blur(12px) saturate(180%);
      border: 1px solid var(--glass-border);
      border-radius: 40px;
      padding: 6px 12px 6px 8px;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: var(--card-shadow);
      transition: all var(--transition-ceremony);
      cursor: pointer;
      color: var(--whisper);
      font-size: 0.9rem;
    }

    .audio-control:hover {
      border-color: var(--wisteria);
      box-shadow: 0 0 18px rgba(197, 157, 217, 0.5);
    }

    .audio-control:focus-visible {
      outline: 3px solid var(--wisteria);
      outline-offset: 2px;
    }

    .album-art {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: url('https://i.ibb.co/Ndjr77H4') center/cover;
      box-shadow: 0 0 12px #e6c8ff;
      transition: transform 0.2s linear;
    }

    .album-art.playing {
      animation: spin 5s infinite linear;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .play-icon {
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--velvet);
      border-radius: 50%;
      color: var(--whisper);
      font-size: 14px;
      transition: transform 0.3s ease;
    }

    .audio-control:hover .play-icon {
      transform: scale(1.1);
      background: var(--wisteria);
    }

    .track-name {
      font-family: var(--font-serif);
      font-size: clamp(0.7rem, 2.5vw, 0.85rem);
      opacity: 0.95;
      max-width: 110px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    @media (max-width: 320px) {
      .audio-player { left: 5px; bottom: 5px; }
      .track-name { max-width: 70px; }
    }

    @media (prefers-reduced-motion: reduce) {
      .album-art.playing { animation: none; }
      .flower-bg { animation: none; }
    }
  </style>
</head>
<body>
  <div class="canvas">
    <div class="card" role="main" aria-label="Valentine's Day interactive card for Sara">
      <div class="particle-field" id="particleField" aria-hidden="true"></div>

      <!-- Scene 1 proposition – human‑crafted text inserted -->
      <div id="scene1" class="scene proposition" role="region" aria-labelledby="greetingText" aria-hidden="false">
        <div class="greeting" id="greetingText">The light in your eyes has become one of the most beautiful constants in my world.</div>
        <div class="name" aria-label="Sara Khan">Sara Khan</div>
        <div class="question" id="questionText">Will you let this Valentine's Day be the first of many we spend together, heart to heart?</div>

        <div class="gestures" role="group" aria-label="Response options">
          <button class="gesture gesture--yes" id="yesBtn" aria-label="Say yes to being Valentine" tabindex="0">YES</button>
          <button class="gesture gesture--no" id="noBtn" aria-label="Not ready yet, but that's okay" tabindex="0">NO</button>
        </div>

        <div id="microResponse" class="micro-response" role="status" aria-live="polite" aria-atomic="true"></div>
      </div>

      <!-- Scene 2: letter with ribbon frame and floating flower – human‑crafted text inserted -->
      <div id="scene2" class="scene scene--hidden letter" role="region" aria-labelledby="letterHead" aria-hidden="true">
        <!-- floating purple flower behind table -->
        <div class="flower-bg" aria-hidden="true"></div>
        <!-- ribbon-wrapped content -->
        <div class="ribbon-frame">
          <div class="letter-head" id="letterHead">My dearest Sara</div>
          <div class="letter-sub" id="letterSub">For you, this Valentine's Day</div>
          <div class="letter-body" role="article" id="letterBody">
            I find myself thinking about the way your nose crinkles slightly when you laugh at something unexpected, and how that simple thing has become one of my favourite sights in the world. I remember the afternoon you spoke about your favourite book with such passion that your hands moved through the air like a conductor guiding an orchestra. It was in that moment I realised I wanted to know every story you carry within you. You possess a gentleness that does not announce itself loudly, yet it settles into a room and makes everything feel softer, safer. Being in your presence feels like standing in the last warm light of a sunset, aware that I am witnessing something truly beautiful and fleeting.
          </div>
          <div class="dua" role="note" aria-label="Prayer for our future" id="duaText">
            May the path ahead of us be lined with shared sunrises and quiet evenings where we need no words at all. May your heart always find peace beside mine, and may we build something steady and enduring from the tenderness we feel today. I pray that whatever comes, we face it hand in hand, with courage and with love enough for both of us.
          </div>
        </div>
      </div>

      <!-- shimmer overlay (preserved) -->
      <div id="shimmer" class="shimmer-effect" aria-hidden="true"></div>

      <!-- ===== SPOTIFY-STYLE AUDIO PLAYER ===== -->
      <div class="audio-player">
        <button id="audioControl" class="audio-control" aria-label="Play background music" title="Play background music">
          <div class="album-art" id="albumArt"></div>
          <span class="play-icon" id="playIcon">▶</span>
          <span class="track-name" id="trackName">Die With A Smile</span>
        </button>
      </div>
      <audio id="bgMusic" loop preload="auto" crossorigin="anonymous">
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" type="audio/mpeg">
      </audio>
    </div>
  </div>

  <script>
    (function() {
      "use strict";

      // DOM elements
      const elements = {
        scene1: document.getElementById('scene1'),
        scene2: document.getElementById('scene2'),
        yesBtn: document.getElementById('yesBtn'),
        noBtn: document.getElementById('noBtn'),
        micro: document.getElementById('microResponse'),
        shimmer: document.getElementById('shimmer'),
        particleField: document.getElementById('particleField'),
        audio: document.getElementById('bgMusic'),
        audioControl: document.getElementById('audioControl'),
        playIcon: document.getElementById('playIcon'),
        trackName: document.getElementById('trackName'),
        albumArt: document.getElementById('albumArt')
      };

      // state
      let isPlaying = false;
      let audioInitialized = false;
      const TRANSITION_MS = 1200;
      let constellationTimer = null;

      // ===== HUMAN WRITTEN MICRO‑RESPONSES ===== (no emoji, complete sentences)
      const microResponses = [
        "Your hesitation does not diminish the depth of what I feel; my heart remains open and steady.",
        "I will hold this question gently in my hands until the moment you feel ready to answer.",
        "There is no rush, Sara. The affection I carry for you is patient and knows how to wait.",
        "Even a 'no' today would not erase the tenderness I hold for you; it would simply wait for tomorrow.",
        "Knowing you has already given me more than I could have asked for; your comfort matters above all.",
        "Every moment we share, even this one, is precious to me, and I will not let it pass without gratitude.",
        "Your presence in my life is a gift I never take for granted, regardless of the answer you give."
      ];

      // particles (unchanged)
      function initParticles() {
        if (!elements.particleField) return;
        elements.particleField.innerHTML = '';
        const particles = [
          { top: '5%', left: '5%', width: 180, height: 180, duration: 18, color: '#d9b0e8', delay: 0 },
          { bottom: '10%', right: '0%', width: 240, height: 240, duration: 22, color: '#b887cf', opacity: 0.4, delay: -3 },
          { top: '30%', right: '15%', width: 110, height: 110, duration: 14, color: '#f2d9ff', delay: 0 }
        ];
        particles.forEach(config => {
          const orb = document.createElement('div');
          orb.className = 'orb';
          Object.assign(orb.style, {
            top: config.top || 'auto',
            left: config.left || 'auto',
            bottom: config.bottom || 'auto',
            right: config.right || 'auto',
            width: config.width + 'px',
            height: config.height + 'px',
            background: `radial-gradient(circle, ${config.color}, transparent 75%)`,
            opacity: config.opacity || 0.5,
            animationDuration: config.duration + 's',
            animationDelay: config.delay + 's'
          });
          elements.particleField.appendChild(orb);
        });
      }

      // AUDIO + album spin
      function toggleAudio() {
        if (!elements.audio) return;
        if (isPlaying) {
          elements.audio.pause();
          if (elements.playIcon) elements.playIcon.textContent = '▶';
          if (elements.albumArt) elements.albumArt.classList.remove('playing');
          elements.audioControl.setAttribute('aria-label', 'Play background music');
        } else {
          const playPromise = elements.audio.play();
          if (playPromise !== undefined) {
            playPromise.then(() => {
              if (elements.playIcon) elements.playIcon.textContent = '⏸';
              if (elements.albumArt) elements.albumArt.classList.add('playing');
              elements.audioControl.setAttribute('aria-label', 'Pause background music');
            }).catch(e => console.log('playback prevented:', e));
          }
        }
        isPlaying = !isPlaying;
      }

      function initAudio() {
        if (!elements.audio || !elements.audioControl) return;
        if (elements.trackName) elements.trackName.textContent = "Die With A Smile";

        // autoplay attempt (likely blocked)
        const playPromise = elements.audio.play();
        if (playPromise !== undefined) {
          playPromise.then(() => {
            isPlaying = true;
            if (elements.playIcon) elements.playIcon.textContent = '⏸';
            if (elements.albumArt) elements.albumArt.classList.add('playing');
            elements.audioControl.setAttribute('aria-label', 'Pause background music');
          }).catch(() => {
            isPlaying = false;
            if (elements.playIcon) elements.playIcon.textContent = '▶';
            if (elements.albumArt) elements.albumArt.classList.remove('playing');
            elements.audioControl.setAttribute('aria-label', 'Play background music');
          });
        }
        elements.audioControl.addEventListener('click', toggleAudio);
        elements.audio.addEventListener('ended', () => {
          if (isPlaying) {
            elements.audio.currentTime = 0;
            elements.audio.play();
          }
        });
        audioInitialized = true;
      }

      // scene management
      function showScene(targetScene, hideScene) {
        targetScene.setAttribute('aria-hidden', 'false');
        hideScene.setAttribute('aria-hidden', 'true');
        targetScene.classList.remove('scene--hidden');
        void hideScene.offsetWidth;
        hideScene.style.opacity = '0';
        hideScene.style.transform = 'scale(0.96)';
        targetScene.style.opacity = '1';
        targetScene.style.transform = 'scale(1)';
        setTimeout(() => {
          if (hideScene.style.opacity === '0') {
            hideScene.classList.add('scene--hidden');
          }
        }, TRANSITION_MS * 0.8);
      }

      // shimmer
      function activateShimmer(event) {
        if (!elements.shimmer) return;
        if (event) {
          const rect = event.target.getBoundingClientRect();
          const x = ((rect.left + rect.width/2) / window.innerWidth) * 100;
          const y = ((rect.top + rect.height/2) / window.innerHeight) * 100;
          elements.shimmer.style.setProperty('--x', x + '%');
          elements.shimmer.style.setProperty('--y', y + '%');
        } else {
          elements.shimmer.style.setProperty('--x', '50%');
          elements.shimmer.style.setProperty('--y', '70%');
        }
        elements.shimmer.classList.add('active');
        if (constellationTimer) clearTimeout(constellationTimer);
        constellationTimer = setTimeout(() => {
          elements.shimmer.classList.remove('active');
        }, 1800);
      }

      function hideMicroResponse() {
        if (elements.micro) elements.micro.classList.remove('micro-response--visible');
      }
      function showMicroResponse() {
        if (!elements.micro) return;
        const randomIdx = Math.floor(Math.random() * microResponses.length);
        elements.micro.textContent = '✦ ' + microResponses[randomIdx] + ' ✦';
        elements.micro.classList.add('micro-response--visible');
      }

      // handlers
      function handleYes() {
        hideMicroResponse();
        if (elements.shimmer) elements.shimmer.classList.remove('active');
        showScene(elements.scene2, elements.scene1);
        // screen reader announcement
        const ann = document.createElement('div');
        ann.setAttribute('role', 'status');
        ann.textContent = 'Showing Valentine letter for Sara';
        document.body.appendChild(ann);
        setTimeout(() => ann.remove(), 1000);
      }

      function handleNo(event) {
        if (elements.scene1.classList.contains('scene--hidden')) return;
        showMicroResponse();
        activateShimmer(event);
        if (elements.noBtn) {
          elements.noBtn.style.transform = 'scale(1.08)';
          elements.noBtn.style.color = 'var(--wisteria)';
          setTimeout(() => {
            elements.noBtn.style.transform = 'scale(1)';
            elements.noBtn.style.color = '';
          }, 300);
        }
      }

      function handleKeyDown(e) {
        if (e.key === 'Escape') {
          hideMicroResponse();
          if (elements.shimmer) elements.shimmer.classList.remove('active');
        }
        if (e.key === 'm' || e.key === 'M') {
          if (audioInitialized) toggleAudio();
        }
      }

      // init
      function init() {
        initParticles();
        initAudio();

        elements.scene1.style.opacity = '1';
        elements.scene1.style.transform = 'scale(1)';
        elements.scene2.style.opacity = '0';
        elements.scene2.style.transform = 'scale(0.96)';
        elements.scene1.setAttribute('aria-hidden', 'false');
        elements.scene2.setAttribute('aria-hidden', 'true');

        elements.yesBtn.addEventListener('click', handleYes);
        elements.noBtn.addEventListener('click', handleNo);
        document.addEventListener('keydown', handleKeyDown);
        window.addEventListener('touchstart', () => {}, { passive: true });
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
</body>
</html>
